#run gdisk

gdisk /dev/sdb

create 500M partition as EF00
create partition as 8300

pacman -S git

https://github.com/andrewb91/arch.git

cd arch

chmod +x arch1.sh
chmod +x arch2.sh

RUN ./arch1.sh

cryptsetup luksFormat /dev/sdb2

cryptsetup open /dev/sdb2 cryptlvm

pvcreate /dev/mapper/cryptlvm 

vgcreate vg1 /dev/mapper/cryptlvm

lvcreate -L 40G vg1 -n root
lvcreate -L 10G vg1 -n var
lvcreate -L 16G vg1 -n swap
lvcreate -L 100G vg1 -n home

mkfs.fat -F32 /dev/sdb1
mkfs.ext4 /dev/vg1/root
mkfs.ext4 /dev/vg1/var
mkfs.ext4 /dev/vg1/home
mkswap /dev/vg1/swap

mount /dev/vg1/root /mnt
mkdir /mnt/boot
mount /dev/sdb1 /mnt/boot
mkdir /mnt/var
mount /dev/vg1/var /mnt/var
mkdir /mnt/home
mount /dev/vg1/home /mnt/home

swapon /dev/vg1/swap

run lsblk to verify formatting and mounts

RUN ./arch2.sh

pacstrap /mnt base linux linux-firmware vim intel-ucode lvm2

genfstab -U /mnt >> /mnt/etc/fstab

arch-chroot /mnt

ln -sf /usr/share/zoneinfo/America/Los_Angeles /etc/localtime
hwclock --systohc
sed -i '178s/.//' /etc/locale.gen
locale-gen
echo "LANG=en_US.UTF-8" >> /etc/locale.conf
#echo "KEYMAP=de_CH-latin1" >> /etc/vconsole.conf
echo "mobile" >> /etc/hostname
echo "127.0.0.1 localhost" >> /etc/hosts
echo "::1       localhost" >> /etc/hosts
echo "127.0.1.1 mobile.localdomain mobile" >> /etc/hosts
echo root:password | chpasswd

# You can add xorg to the installation packages, I usually add it at the DE or WM install script
# You can remove the tlp package if you are installing on a desktop or vm

pacman -S grub efibootmgr networkmanager network-manager-applet wireless_tools wpa_supplicant dialog os-prober mtools dosfstools base-devel git bluez bluez-utils pulseaudio-bluetooth cups hplip xdg-utils xdg-users-dirs gufw openssh acpid xorg lightdm lightdm-gtk-greeter lightdm-gtk-greeter-settings firefox arc-gtk-theme arc-icon-theme obs-studio vlc picom cairo openbox thunderbird obconf ttf-dejavu ttf-liberation pcmanfm xfce4-terminal xfce4-panel xfce4-pulseaudio-plugin xfce4-weather-plugin lxappearance lxappearance-obconf feh redshift transmission-gtk blueman youtube-dl samba cmake gnome-mahjongg engrampa pavucontrol openvpn networkmanager-openvpn gimp okular mesa fuse2 fuse3 ntfs-3g exfat-utils dkms man-db man-pages system-config-printer clamav libreoffice-fresh arandr numlockx gvfs gvfs-smb hplip alsa-utils dnsutils materia-theme adwaita-icon-theme rofi papirus-icon-theme sane-airscan libimobiledevice gvfs-gphoto2 ifuse firefox dkms haveged rsync

#GRUB
grub-install --target=x86_64-efi --efi-directory=/boot --bootloader-id=GRUB #change the directory to /boot/efi is you mounted the EFI partition at /boot/efi

configure GRUB as follows:
blkid >> block.txt
vim block.txt

"cc" line for /dev/sdb2

vim /etc/default/grub

(UUID for /dev/sdb2 for cryptlvm  and swap UUID for resume)
GRUB_CMDLINE_LINUX="cryptdevice=UUID=274ffc89-c334-4087-bbaf-cfcc61a3a58f:cryptlvm root=/dev/vg1/root resume=UUID=ed5a70e6-0d6e-44b4-9e5e-0a23911ebbc5"

# mkinitcpio 
vim /etc/minitcpio.conf

HOOKS=(base udev autodetect keyboard modconf block encrypt lvm2 resume filesystems fsck)
save/quit
mkinitcpio -p linux


RUN ./arch3.sh

grub-mkconfig -o /boot/grub/grub.cfg

systemctl enable NetworkManager
systemctl enable bluetooth
systemctl enable cups
systemctl enable fstrim.timer
systemctl enable libvirtd
systemctl enable ufw
systemctl enable acpid

useradd -m drew
echo drew:password | chpasswd

echo "drew ALL=(ALL) ALL" >> /etc/sudoers.d/drew


